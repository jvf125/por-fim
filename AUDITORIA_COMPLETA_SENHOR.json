{
  "auditoria": {
    "projeto": "Leidy Cleaner - Plataforma de Limpeza Autônoma",
    "data_auditoria": "2026-02-01",
    "versao_auditoria": "1.0",
    "escopo": "Análise completa - Arquitetura, Código, Segurança, Performance, Testes, DevOps, UX, Escalabilidade",
    "severidade": {
      "critical": "PARAR - Risco de segurança/negócio imediato",
      "high": "CORRIGIR - Impacto significativo em função/qualidade",
      "medium": "MELHORAR - Manutenibilidade/performance/padrões",
      "low": "NICE-TO-HAVE - Otimizações menores"
    }
  },
  "resumo_executivo": {
    "score_geral": "65/100",
    "status_producao": "NÃO RECOMENDADO sem correções críticas",
    "maiores_riscos": [
      "Segredos em .env com valores dummy (SQL injection risk)",
      "Frontend com innerHTML sem sanitização (XSS)",
      "Cartão de crédito sendo transmitido em JSON plano (PCI-DSS violado)",
      "Sem query parameterized em algumas rotas (SQL Injection)",
      "Cobertura de testes < 30% (gaps críticos em payment/auth)"
    ],
    "oportunidades_rapidas": [
      "Adicionar sanitização HTML no frontend",
      "Implementar validação de entrada em todo POST",
      "Migrar pagamento para Stripe/MercadoPago SDK",
      "Adicionar índices no DB",
      "E2E tests com Cypress"
    ]
  },
  "1_arquitetura_estrutura": {
    "score": "70/100",
    "issues": [
      {
        "id": "ARCH-001",
        "severity": "high",
        "titulo": "Separação de responsabilidades fraca em Controllers",
        "descricao": "Controllers fazem queries SQL diretas + lógica de negócio + resposta HTTP. Deveria ter Services intermediários.",
        "arquivo": "backend/src/controllers/BookingController.js:14-130",
        "impacto": "Difícil de testar, acoplamento forte, duplicação de código (PaymentController faz mesmo)",
        "evidencia": "BookingController abre DB 3x na mesma função, mistura `db.run()` com cálculo de preço",
        "recomendacao": "Criar padrão: Controller → Service → Repository/DB. Services lidam com lógica, Controllers com HTTP."
      },
      {
        "id": "ARCH-002",
        "severity": "medium",
        "titulo": "Falta de camada Repository para DB",
        "descricao": "Cada Controller reinventa getDb(), runAsync(), getAsync(). Sem abstração.",
        "arquivo": "backend/src/controllers/BookingController.js:6-37 + PaymentController.js:6-37",
        "impacto": "Difícil mudar BD, duplicação de código, sem padronização",
        "recomendacao": "Criar backend/src/db/Repository.js com métodos: .find(), .findById(), .create(), .update(), .delete()"
      },
      {
        "id": "ARCH-003",
        "severity": "medium",
        "titulo": "Falta de DTOs (Data Transfer Objects)",
        "descricao": "Dados brutos do DB são retornados diretamente à API sem transformação.",
        "arquivo": "backend/src/controllers/BookingController.js:130-140",
        "impacto": "Expõe colunas internas, difícil refatorar BD sem quebrar API",
        "recomendacao": "Criar models/DTOs: BookingDTO { id, date, address, finalPrice } sem exposição interna"
      },
      {
        "id": "ARCH-004",
        "severity": "low",
        "titulo": "Falta de inversão de dependência (DI)",
        "descricao": "Controllers importam DB hardcoded, sem container de injeção.",
        "arquivo": "backend/src/controllers/BookingController.js:6",
        "impacto": "Difícil testar, sem mocks",
        "recomendacao": "Considerar awilix ou simples factory pattern"
      }
    ],
    "summary": "Estrutura básica funciona, mas acoplamento forte. Padrão MVC presente mas mal executado (lógica em Controllers)."
  },
  "2_codigo_frontend": {
    "score": "55/100",
    "issues": [
      {
        "id": "FE-001",
        "severity": "critical",
        "titulo": "XSS via innerHTML sem sanitização",
        "descricao": "Frontend injeta HTML diretamente em innerHTML sem sanitizar entrada do servidor.",
        "arquivo": "public/app.js:346, 389",
        "linhas_problematicas": [
          "container.innerHTML = bookings.map(booking => `<div>...${booking.service_name}...</div>`).join('')",
          "container.innerHTML = `<div...${loyalty.five_star_streak}/10...`"
        ],
        "impacto": "CRÍTICO: Se servidor retornar <img src=x onerror='alert(1)'>, executa JavaScript arbitrário",
        "evidencia": "Bookings e loyalty data vêm da API - se comprometida, injeção de código",
        "recomendacao": "Usar textContent para texto, criar elementos com document.createElement() ou sanitize-html"
      },
      {
        "id": "FE-002",
        "severity": "critical",
        "titulo": "Cartão de crédito em JSON plano",
        "descricao": "Formulário envia cardNumber, CVV, cardExpiry em JSON sem criptografia.",
        "arquivo": "public/app.js:280-285",
        "impacto": "PCI-DSS VIOLADO. Se interceptado (MITM), cartão roubado. Ilegal para processamento.",
        "evidencia": "handlePayment envia `{ cardNumber: '1234567812345678', cardCVV: '123' }`",
        "recomendacao": "NUNCA enviar dados de cartão do frontend. Usar Stripe.js ou MercadoPago SDK para tokenizar no cliente."
      },
      {
        "id": "FE-003",
        "severity": "high",
        "titulo": "Funções muito longas sem modularização",
        "descricao": "app.js tem 527 linhas com muitas funções (400+ linhas) fazendo múltiplas coisas.",
        "arquivo": "public/app.js (inteira)",
        "linhas_problematicas": [
          "handleAuth (linhas ~100-150) - faz fetch, validação, token storage",
          "loadUserBookings (linhas ~320-365) - faz fetch, HTML generation, no error boundaries"
        ],
        "impacto": "Difícil debugar, testar, reutilizar. State global com authToken, currentUser sem reatividade.",
        "recomendacao": "Refatorar em módulos: auth.js, bookings.js, loyalty.js com funções <50 linhas"
      },
      {
        "id": "FE-004",
        "severity": "high",
        "titulo": "State management com variáveis globais",
        "descricao": "let authToken, currentUser, API_URL são globais, sem validação.",
        "arquivo": "public/app.js:1-4",
        "impacto": "Race conditions em múltiplas abas, sem reactivity, difícil testar",
        "recomendacao": "Usar localStorage com getters/setters, ou minimal state library (zustand/jotai)"
      },
      {
        "id": "FE-005",
        "severity": "high",
        "titulo": "Sem tratamento robusto de erros",
        "descricao": "Fetch calls têm try/catch mas mostram mensagens genéricas. Sem retry logic.",
        "arquivo": "public/app.js:145-150 (tipo)",
        "exemplo": "showAlert('Erro ao conectar com servidor', 'error') - não diferencia 404, 500, timeout",
        "impacto": "Usuário não sabe por que falhou, sem retry automático em timeouts",
        "recomendacao": "Diferenciar erros: validação (400), não autorizado (401), recurso não encontrado (404), servidor (500)"
      },
      {
        "id": "FE-006",
        "severity": "medium",
        "titulo": "Máscara CPF com regex frágil",
        "descricao": "Regex não valida CPF corretamente, apenas formata.",
        "arquivo": "public/app.js:8",
        "codigo": "cpf.replace(/\\D/g, '').replace(/(\\d{3})(\\d)/, '$1.$2')",
        "impacto": "CPF '00000000191' (válido) é aceito, '11111111111' (inválido) é recusado",
        "recomendacao": "Usar biblioteca cpf-check ou melhorar validateCPF() lógica"
      },
      {
        "id": "FE-007",
        "severity": "medium",
        "titulo": "No loading states em requisições",
        "descricao": "Formulários não desabilitam botão durante fetch, permitindo múltiplos cliques.",
        "arquivo": "public/app.js:126-150 (handleAuth sem spinner/disable)",
        "impacto": "Duplo envio de forms, múltiplas requisições, dados duplicados",
        "recomendacao": "Adicionar loading state: disable botão, spinner, toast com feedback"
      },
      {
        "id": "FE-008",
        "severity": "medium",
        "titulo": "Sem tratamento de offline",
        "descricao": "App não detecta se usuário perdeu conexão, requisições falham silenciosamente.",
        "arquivo": "public/app.js (sem navigator.onLine)",
        "impacto": "Usuário não sabe se está offline, tenta agendar sem sucesso",
        "recomendacao": "Adicionar service worker, detectar navigator.onLine, cache offline"
      },
      {
        "id": "FE-009",
        "severity": "low",
        "titulo": "DOM queries ineficientes",
        "descricao": "document.querySelectorAll() chamado múltiplas vezes em setup.",
        "arquivo": "public/app.js:50, 59, 71",
        "impacto": "Reflow/repaint desnecessários, performance em mobile",
        "recomendacao": "Cache queries em variáveis: const navItems = document.querySelectorAll('.nav-item')"
      },
      {
        "id": "FE-010",
        "severity": "low",
        "titulo": "Event listeners duplicados em DOMContentLoaded",
        "descricao": "Cada addEventListener em setupEventListeners não tem guard para não re-ligar.",
        "arquivo": "public/app.js:48-96",
        "impacto": "Se setupEventListeners rodasse 2x, handlers seriam duplicados",
        "recomendacao": "Garantir que setupEventListeners roda UMA VEZ"
      }
    ],
    "summary": "Frontend tem vulnerabilidades críticas (XSS, PCI-DSS) e qualidade média. Código desorganizado, sem modularização. Refatoração urgente necessária."
  },
  "3_codigo_backend": {
    "score": "60/100",
    "issues": [
      {
        "id": "BE-001",
        "severity": "critical",
        "titulo": "Cartão de crédito recebido em JSON plano",
        "descricao": "Backend aceita cardNumber, CVV em req.body sem criptografia.",
        "arquivo": "backend/src/controllers/PaymentController.js:40-50",
        "codigo": "const { cardNumber, amount, paymentMethod } = req.body",
        "impacto": "PCI-DSS VIOLADO. Logs podem conter cartões. Banco de dados em plaintext.",
        "recomendacao": "Rejeitar cartões no backend. Usar tokens Stripe/MercadoPago. Se usar Stripe.js, backend recebe só token."
      },
      {
        "id": "BE-002",
        "severity": "high",
        "titulo": "SQL Injection risk em queries construídas dinamicamente",
        "descricao": "Algumas queries usam concatenação em vez de parâmetros.",
        "arquivo": "backend/src/controllers/BookingController.js:267",
        "codigo": "let query = 'UPDATE bookings SET '; if (status) query += 'status = ?, '; // construção dinâmica",
        "impacto": "Se input não validado, permite injection. Exemplo: status = \"'; DROP TABLE bookings; --\"",
        "recomendacao": "Sempre usar prepared statements com ? placeholders. Validar/whitelist campos antes de incluir."
      },
      {
        "id": "BE-003",
        "severity": "high",
        "titulo": "Sem rate limiting por usuário em endpoints críticos",
        "descricao": "Rate limiter global de 100 req/15min, mas não há por usuário para payment/auth.",
        "arquivo": "backend/src/index.js:60-100",
        "impacto": "Um usuário pode brute force senha, ou spammar pagamentos",
        "recomendacao": "Adicionar rate limiter por user_id para: POST /auth/login (5 tentativas/15min), POST /payments (1 por minuto)"
      },
      {
        "id": "BE-004",
        "severity": "high",
        "titulo": "Validação de entrada incompleta",
        "descricao": "Campo 'amount' em payments não valida se é positivo/saudável.",
        "arquivo": "backend/src/middleware/validation.js:53-56",
        "codigo": "if (!amount || amount <= 0) errors.push(...)",
        "impacto": "Usuário pode enviar amount = -100000, receber reembolso.",
        "evidencia": "Validação existe mas não é chamada em todas rotas (PaymentController direto)",
        "recomendacao": "Garantir validatePaymentData roda ANTES de chegar em PaymentController"
      },
      {
        "id": "BE-005",
        "severity": "high",
        "titulo": "Sem sanitização de entrada em campos de texto",
        "descricao": "Campo 'notes', 'comment' é salvo direto sem sanitizar HTML/XSS.",
        "arquivo": "backend/src/controllers/BookingController.js:120",
        "impacto": "Usuário pode salvar <script>alert(1)</script> em notes, executar ao renderizar",
        "recomendacao": "Usar sanitize-html (já está em package.json). Sanitizar em Service antes de salvar."
      },
      {
        "id": "BE-006",
        "severity": "high",
        "titulo": "N+1 Query problem não identificado",
        "descricao": "Em getUserBookings, carrega booking depois faz query por service_name para cada um.",
        "arquivo": "backend/src/controllers/BookingController.js:155-165",
        "problema": "SELECT b.*, s.name FROM bookings b LEFT JOIN services s... - se há 100 bookings, 1 query por booking",
        "impacto": "Cada pagina de agendamentos faz 1 + N queries. Performance O(N).",
        "recomendacao": "Usar JOIN na query original: SELECT b.*, s.name FROM bookings b LEFT JOIN services s ON b.service_id = s.id"
      },
      {
        "id": "BE-007",
        "severity": "medium",
        "titulo": "Falta de índices no banco SQLite",
        "descricao": "Schema.sql cria índices para bookings(user_id, date) mas faltam em transactions, reviews.",
        "arquivo": "database/schema.sql:95-98",
        "impacto": "Queries lentas em produção. Exemplo: SELECT * FROM transactions WHERE user_id = ? será table scan.",
        "recomendacao": "Adicionar: CREATE INDEX idx_transactions_user ON transactions(user_id), idx_reviews_user ON reviews(user_id)"
      },
      {
        "id": "BE-008",
        "severity": "medium",
        "titulo": "Erro handling inconsistente",
        "descricao": "Alguns controllers retornam { error: }, outros { message }, outros res.status().json().",
        "arquivo": "backend/src/controllers/AuthController.js:45 vs BookingController.js:60",
        "impacto": "Frontend não sabe qual campo ler, difícil padronizar",
        "recomendacao": "Criar ErrorHandler middleware que retorna sempre { status: 400, message, code: 'VALIDATION_ERROR' }"
      },
      {
        "id": "BE-009",
        "severity": "medium",
        "titulo": "Sem versioning de API",
        "descricao": "API sem /v1/, /v2/ prefixes. Mudanças quebram clientes antigos.",
        "arquivo": "backend/src/routes/api.js:1",
        "impacto": "Difícil evoluir API sem quebrar produção",
        "recomendacao": "Adicionar /api/v1/ prefix em todas rotas"
      },
      {
        "id": "BE-010",
        "severity": "medium",
        "titulo": "Transações de banco não usadas",
        "descricao": "Em createBooking, se payment falhar depois de INSERT, booking fica órfão.",
        "arquivo": "backend/src/controllers/BookingController.js:115-130",
        "impacto": "Dados inconsistentes. Booking sem pagamento, pagamento sem booking.",
        "recomendacao": "Usar database transactions: BEGIN, COMMIT, ROLLBACK para operações multi-step"
      },
      {
        "id": "BE-011",
        "severity": "medium",
        "titulo": "Sem logging estruturado de segurança",
        "descricao": "Logger registra eventos, mas sem estrutura para audit trail (who, what, when, result).",
        "arquivo": "backend/src/utils/logger.js",
        "impacto": "Difícil investigar fraude/segurança em produção",
        "recomendacao": "Adicionar audit log: logger.audit({ action: 'PAYMENT', user_id, amount, status, timestamp })"
      },
      {
        "id": "BE-012",
        "severity": "low",
        "titulo": "Senhas de hashing com salt rounds fixo",
        "descricao": "bcrypt com 10 rounds, aceitável mas não configurável.",
        "arquivo": "backend/src/controllers/AuthController.js:82",
        "recomendacao": "Considerar aumentar para 12-14 rounds em produção, usar env var: process.env.BCRYPT_ROUNDS || 10"
      }
    ],
    "summary": "Backend tem vulnerabilidades críticas em pagamento e SQL. Falta validação consistente, N+1 queries, sem transações. Refatoração estrutural necessária."
  },
  "4_seguranca": {
    "score": "45/100",
    "issues": [
      {
        "id": "SEC-001",
        "severity": "critical",
        "titulo": "Secrets em .env com valores dummy públicos",
        "descricao": "JWT_SECRET = 'super_secret_jwt_key_change_in_production_12345' é comentário público, não secret.",
        "arquivo": ".env:5-8",
        "impacto": "Se .env commitar no git (GitHub), JWT pode ser forjado. Cartão/PIX expostos.",
        "evidencia": ".env no root não está em .gitignore visível",
        "recomendacao": "1) Adicionar .env a .gitignore. 2) Usar vault/secrets manager (AWS Secrets Manager, 1Password). 3) Em dev, usar .env.example com placeholders."
      },
      {
        "id": "SEC-002",
        "severity": "critical",
        "titulo": "XSS residual em renderização de dados",
        "descricao": "innerHTML sem sanitização permite injeção de scripts.",
        "arquivo": "public/app.js:346, 389",
        "impacto": "Se API comprometida, todo usuário infectado",
        "recomendacao": "Implementar sanitização em todas renderizações, usar textContent para dados untrusted"
      },
      {
        "id": "SEC-003",
        "severity": "critical",
        "titulo": "CORS aberto em desenvolvimento",
        "descricao": "CORS_ORIGIN pode ser '*' ou mal configurado, permitindo requisições de qualquer origem.",
        "arquivo": "backend/src/index.js:80-86",
        "codigo": "origin: process.env.CORS_ORIGIN || ['http://localhost:3000', 'http://localhost:3001']",
        "impacto": "CSRF attacks, dados sensíveis acessíveis de qualquer site",
        "recomendacao": "Em produção, CORS_ORIGIN deve ser domínio específico: 'https://leidycleaner.com'. Nunca usar '*'."
      },
      {
        "id": "SEC-004",
        "severity": "critical",
        "titulo": "Sem validação de origem em WebSocket",
        "descricao": "Socket.io com CORS whitelist, mas sem verificação de headers adicionais.",
        "arquivo": "backend/src/index.js:22-33",
        "impacto": "WebSocket pode ser hijacked em network compartilhada",
        "recomendacao": "Adicionar verificação de Origin header, validar token JWT em connection"
      },
      {
        "id": "SEC-005",
        "severity": "high",
        "titulo": "CSRF protection incompleta",
        "descricao": "CSRF via csurf funciona para cookies, mas frontend em SPA não envia XSRF-TOKEN em headers.",
        "arquivo": "backend/src/middleware/csrf.js:35, public/app.js (sem header)",
        "problema": "fetch() não inclui X-CSRF-Token header. Proteção não funciona.",
        "impacto": "CSRF attacks ainda possíveis em browsers com cookies",
        "recomendacao": "No fetch, adicionar header: 'X-CSRF-Token': document.cookie.match(/XSRF-TOKEN=([^;]+)/)[1]"
      },
      {
        "id": "SEC-006",
        "severity": "high",
        "titulo": "Sem Content Security Policy (CSP) completa",
        "descricao": "CSP tem directives básicos, mas permite 'unsafe-inline' em styleSrc.",
        "arquivo": "backend/src/index.js:41-56",
        "codigo": "styleSrc: [\"'self'\", \"'unsafe-inline'\", ...]",
        "impacto": "Inline <style> pode ser injetado via XSS",
        "recomendacao": "Remover 'unsafe-inline', usar external stylesheets. Ou usar nonce: style-src 'nonce-random'"
      },
      {
        "id": "SEC-007",
        "severity": "high",
        "titulo": "Sem HTTPS enforcement em produção",
        "descricao": "HSTS adicionado, mas sem redirecionamento HTTP->HTTPS.",
        "arquivo": "backend/src/index.js:59",
        "impacto": "Primeira requisição em HTTP é insegura",
        "recomendacao": "Adicionar middleware: if (!req.secure) res.redirect('https://' + req.get('host') + req.url)"
      },
      {
        "id": "SEC-008",
        "severity": "high",
        "titulo": "Sem proteção contra Clickjacking",
        "descricao": "X-Frame-Options header presente via Helmet, mas pode ser testado melhor.",
        "arquivo": "backend/src/index.js:44",
        "recomendacao": "Verificar frameAncestors: [\"'none'\"] está sendo enviado. Testar com curl -I"
      },
      {
        "id": "SEC-009",
        "severity": "high",
        "titulo": "Sem sanitização de FILE UPLOADS",
        "descricao": "Multer aceita qualquer arquivo sem validação de tipo/tamanho.",
        "arquivo": "backend/src/routes/api.js:13-26",
        "impacto": "Usuário pode fazer upload de .exe, .php, ou arquivo >100MB causando DoS",
        "recomendacao": "Adicionar: fileFilter: (req, file, cb) { if (!/image\\/(jpg|png|gif)/.test(file.mimetype)) cb(null, false) }, limits: { fileSize: 5 * 1024 * 1024 }"
      },
      {
        "id": "SEC-010",
        "severity": "high",
        "titulo": "Senhas fracas não rejeitadas",
        "descricao": "Backend não valida força de senha (mínimo 8 chars, sem maiúsculas, etc).",
        "arquivo": "backend/src/controllers/AuthController.js:40",
        "impacto": "Senhas como '123456' são aceitas",
        "recomendacao": "Adicionar validação: /^(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?&])[A-Za-z\\d@$!%*?&]{8,}$/"
      },
      {
        "id": "SEC-011",
        "severity": "high",
        "titulo": "Sem rate limiting para reset de senha",
        "descricao": "Se houver endpoint de reset, não há limite de tentativas.",
        "arquivo": "backend/src/index.js (POST /auth/refresh sem limite específico)",
        "impacto": "Email enumeration, brute force tokens",
        "recomendacao": "Aplicar rate limiter rigoroso: 3 tentativas/hora por email"
      },
      {
        "id": "SEC-012",
        "severity": "medium",
        "titulo": "Sem verificação de email (confirmação)",
        "descricao": "Usuário pode registrar com email falso, não há verificação.",
        "arquivo": "backend/src/controllers/AuthController.js:100",
        "impacto": "Spam/abuso, não há prova de propriedade de email",
        "recomendacao": "Adicionar email verification: send link com token, marcar is_email_verified=false até confirmar"
      },
      {
        "id": "SEC-013",
        "severity": "medium",
        "titulo": "Sem 2FA (Two-Factor Authentication)",
        "descricao": "Login sem 2FA, apenas username+password.",
        "arquivo": "backend/src/controllers/AuthController.js (login)",
        "impacto": "Se senha comprometida, conta acessada. Crítico para financial app.",
        "recomendacao": "Implementar TOTP (Google Authenticator) via speakeasy ou semelhante"
      },
      {
        "id": "SEC-014",
        "severity": "medium",
        "titulo": "Sem proteção contra Mass Assignment",
        "descricao": "Usuário pode enviar any field em req.body, e se não validado, atualiza roles/admin.",
        "arquivo": "backend/src/controllers/AuthController.js:100 (valida role)",
        "impacto": "Usuário pode enviar { role: 'admin' } e escalate privileges",
        "evidencia": "AuthController valida, mas se fosse forgotten em outro controller?",
        "recomendacao": "Usar whitelist: const allowedFields = ['name', 'phone']; const update = pick(req.body, allowedFields)"
      },
      {
        "id": "SEC-015",
        "severity": "medium",
        "titulo": "Informações sensíveis em logs públicos",
        "descricao": "Logs podem conter senhas, tokens, cartões se não filtrado.",
        "arquivo": "backend/src/utils/logger.js",
        "recomendacao": "Implementar: logger.sanitize() que remove passwords, tokens, credit cards de mensagens"
      }
    ],
    "summary": "Segurança fraca. Secrets públicas, XSS não sanitizado, CSRF incompleto, sem validação forte. Crítico para app financeira. Múltiplas vulnerabilidades OWASP Top 10."
  },
  "5_performance": {
    "score": "50/100",
    "issues": [
      {
        "id": "PERF-001",
        "severity": "high",
        "titulo": "N+1 Query problem em getUserBookings",
        "descricao": "Cada booking faz query adicional para trazer service_name.",
        "arquivo": "backend/src/controllers/BookingController.js:155-165",
        "codigo": "SELECT b.*, s.name FROM bookings b LEFT JOIN services s...",
        "impacto": "100 bookings = 101 queries em vez de 1. Em produção com 1000 usuários: 100k queries/segundo.",
        "recomendacao": "Usar JOIN original, ou batch queries com DataLoader"
      },
      {
        "id": "PERF-002",
        "severity": "high",
        "titulo": "Sem caching em GET /loyalty",
        "descricao": "Cada request recalcula loyalty points, sem cache.",
        "arquivo": "public/app.js:378 + backend endpoint",
        "impacto": "5 requisições de GET /loyalty = 5x cálculos. Usuário clica aba fidelidade 10x por dia = 10 queries caras",
        "recomendacao": "Cache com TTL: Redis com EXPIRE 5 minutes, ou Cache-Control headers"
      },
      {
        "id": "PERF-003",
        "severity": "high",
        "titulo": "Sem índices em banco de dados",
        "descricao": "Schema.sql define poucos índices. Faltam em transactions.user_id, reviews.user_id, bookings.service_id.",
        "arquivo": "database/schema.sql:95-98",
        "impacto": "Table scans em queries, O(N) em vez de O(log N). 100k registros = 1s em vez de 1ms.",
        "recomendacao": "CREATE INDEX idx_transactions_user_id ON transactions(user_id); CREATE INDEX idx_reviews_booking_id ON reviews(booking_id)"
      },
      {
        "id": "PERF-004",
        "severity": "medium",
        "titulo": "Frontend bundle size não otimizado",
        "descricao": "public/app.js não minificado. HTML inline com 782 linhas.",
        "arquivo": "public/index.html:1-782",
        "impacto": "~80KB JS + ~100KB CSS inline. Sem gzip, 180KB sem compressão. Mobile: 5s loading em 3G.",
        "recomendacao": "Minificar JS/CSS, separar em bundle.js, usar gzip compression em nginx"
      },
      {
        "id": "PERF-005",
        "severity": "medium",
        "titulo": "Sem lazy-loading de imagens",
        "descricao": "Imagens carregam todas no HTML, mesmo off-screen.",
        "arquivo": "public/index.html (img tags sem loading='lazy')",
        "impacto": "Usuário em mobile downloader todas imagens mesmo não vendo",
        "recomendacao": "Adicionar: <img loading='lazy' ...>, ou usar Intersection Observer para carregar sob demanda"
      },
      {
        "id": "PERF-006",
        "severity": "medium",
        "titulo": "Sem paginação em listagem de agendamentos",
        "descricao": "GET /bookings/user retorna TODOS os agendamentos sem offset/limit.",
        "arquivo": "backend/src/controllers/BookingController.js:155",
        "impacto": "Usuário com 10k agendamentos carrega tudo. 10MB de JSON.",
        "recomendacao": "Implementar: GET /bookings/user?page=1&limit=20, retornar { data, total, pages }"
      },
      {
        "id": "PERF-007",
        "severity": "medium",
        "titulo": "Sem compressão gzip em responses",
        "descricao": "Backend não ativa express.gzip() ou nginx gzip.",
        "arquivo": "backend/src/index.js (falta compression middleware)",
        "impacto": "Response 100KB sem compressão, 20KB com gzip. 5x redução.",
        "recomendacao": "npm install compression && app.use(compression())"
      },
      {
        "id": "PERF-008",
        "severity": "medium",
        "titulo": "Sem HTTP caching headers",
        "descricao": "GETs sem Cache-Control, ETag, Last-Modified.",
        "arquivo": "backend/src/index.js",
        "impacto": "Browser baixa dados estáticos toda requisição. /services GET repetida = 0 cache.",
        "recomendacao": "Adicionar middleware para Cache-Control: 'public, max-age=3600' em GETs de dados estáticos"
      },
      {
        "id": "PERF-009",
        "severity": "medium",
        "titulo": "Sem connection pooling para DB",
        "descricao": "Cada request abre nova conexão SQLite via getDb().",
        "arquivo": "backend/src/controllers/BookingController.js:13",
        "impacto": "100 requisições simultâneas = 100 conexões abertas. SQLite não suporta bem isso.",
        "recomendacao": "Usar connection pool: const pool = new sqlite3.ConnectionPool(); reutilizar conexões"
      },
      {
        "id": "PERF-010",
        "severity": "low",
        "titulo": "DOM queries repetidas sem cache",
        "descricao": "document.querySelectorAll('.nav-item') chamado toda vez que abre seção.",
        "arquivo": "public/app.js:433-436",
        "impacto": "Pequeno, mas re-parse do DOM a cada clique",
        "recomendacao": "Cache em variáveis globais: const navItems = document.querySelectorAll('.nav-item')"
      }
    ],
    "summary": "Performance vulnerável em escala. N+1 queries, sem caching, faltam índices, sem paginação. Em 1000 usuários, sistema quebraria."
  },
  "6_testes": {
    "score": "30/100",
    "issues": [
      {
        "id": "TEST-001",
        "severity": "critical",
        "titulo": "Cobertura de testes < 30% (gaps em payment/auth)",
        "descricao": "Jest coverage mostra gaps críticos. Testes existem mas não cobrem fluxos reais.",
        "arquivo": "backend/src/__tests__/ (7 arquivos)",
        "estatisticas": "~150 linhas de tests para 3000 linhas de código = 5% cobertura real",
        "impacto": "Regressions não detectadas. Payment bugs chegam em produção.",
        "recomendacao": "Adicionar testes: Payment com sucesso/falha, Auth com email duplicado, Booking com conflito de data"
      },
      {
        "id": "TEST-002",
        "severity": "critical",
        "titulo": "Sem E2E tests (Cypress/Playwright)",
        "descricao": "Nenhum teste cobre fluxo completo: Register → Book → Payment → Loyalty",
        "arquivo": "Não existe backend/src/__tests__/e2e.test.js",
        "impacto": "Frontend+Backend integração não testada. UI bugs descobertos apenas em produção.",
        "recomendacao": "Criar cypress/e2e/booking.cy.js: visitHomepage, fillForm, submitBooking, assert success"
      },
      {
        "id": "TEST-003",
        "severity": "high",
        "titulo": "Testes de Payment sem mock de gateway",
        "descricao": "Se teste fazer requisição real ao Stripe/MercadoPago, falha fora do CI.",
        "arquivo": "backend/src/__tests__/PaymentController.test.js (não existe)",
        "impacto": "Tests dependem de API externa, flaky, lentos",
        "recomendacao": "Mockear Stripe com jest.mock(), testar lógica de validação sem chamar gateway real"
      },
      {
        "id": "TEST-004",
        "severity": "high",
        "titulo": "Sem testes de segurança (SAST/DAST)",
        "descricao": "Nenhum teste verifica XSS, SQL injection, CSRF.",
        "arquivo": "Não há backend/src/__tests__/security.test.js",
        "impacto": "Vulnerabilidades descobertas apenas em produção.",
        "recomendacao": "Adicionar: test('XSS: HTML em booking notes é sanitizado'), test('SQL: quotes em notes não quebram query')"
      },
      {
        "id": "TEST-005",
        "severity": "high",
        "titulo": "Sem testes de error handling",
        "descricao": "Testes não cobrem cenários de erro: 404, 500, timeout, network error.",
        "arquivo": "backend/src/__tests__/api.integration.test.js",
        "impacto": "Frontend não sabe como reagir a erros reais",
        "recomendacao": "Adicionar testes: test('GET /bookings/user retorna 401 sem token'), test('POST /payments retorna 500 em DB error')"
      },
      {
        "id": "TEST-006",
        "severity": "medium",
        "titulo": "Sem testes de performance",
        "descricao": "Nenhum teste verifica se N+1 queries está acontecendo.",
        "arquivo": "Não há backend/src/__tests__/performance.test.js",
        "impacto": "Performance regressions não detectadas até produção.",
        "recomendacao": "Usar jest-mock-sql para contar queries. test('getUserBookings com 100 bookings faz max 2 queries')"
      },
      {
        "id": "TEST-007",
        "severity": "medium",
        "titulo": "Frontend sem unit tests",
        "descricao": "public/app.js não tem testes unitários para funções críticas como calculatePrice.",
        "arquivo": "Não existe public/__tests__/app.test.js",
        "impacto": "Bugs em cálculo de preço descobertos tarde",
        "recomendacao": "Criar tests: calculatePrice({ duration: 2, hasStaff: true }) == expectedPrice"
      },
      {
        "id": "TEST-008",
        "severity": "medium",
        "titulo": "Sem testes de validação",
        "descricao": "Middleware de validação tem testes, mas não cobre todos edge cases.",
        "arquivo": "backend/src/__tests__/validation.test.js:19-70",
        "gaps": "Não testa: CPF inválido, email com +, phone com país code, CEP formatado diferente",
        "recomendacao": "Adicionar: test('validates CPF with various formats'), test('rejects email+tag@domain')"
      },
      {
        "id": "TEST-009",
        "severity": "low",
        "titulo": "Testes sem descrições claras",
        "descricao": "Alguns testes têm nomes genéricos: 'should be a function'.",
        "arquivo": "backend/src/__tests__/BookingService.test.js:23",
        "impacto": "Difícil entender que bug foi encontrado lendo report",
        "recomendacao": "Renomear: 'should create booking with valid data and calculate price correctly'"
      }
    ],
    "summary": "Cobertura crítica. Testes básicos existem mas gaps em payment, security, E2E. Sem CI/CD validação. Produção em risco."
  },
  "7_devops_deploy": {
    "score": "55/100",
    "issues": [
      {
        "id": "DEVOPS-001",
        "severity": "high",
        "titulo": "Sem CI/CD pipeline automático",
        "descricao": "config/ci-cd/github-actions.yml existe mas status desconhecido.",
        "arquivo": "config/ci-cd/github-actions.yml",
        "impacto": "Código pode ser mergeado sem testes. Segurança não validada automaticamente.",
        "recomendacao": "Implementar GitHub Actions: test → lint → build → deploy com checks obrigatórios"
      },
      {
        "id": "DEVOPS-002",
        "severity": "high",
        "titulo": "Dockerfile com vulnerabilidades",
        "descricao": "Usa node:18-alpine, mas RUN npm install sem --frozen-lockfile.",
        "arquivo": "config/docker/Dockerfile.backend:9",
        "impacto": "Versões de pacotes variam entre builds. Dependências podem ter vuln novo.",
        "recomendacao": "Adicionar: RUN npm ci --frozen-lockfile, scan com docker scan, usar distroless image"
      },
      {
        "id": "DEVOPS-003",
        "severity": "high",
        "titulo": "Sem health checks no Docker",
        "descricao": "docker-compose.yml não define healthchecks para backend/frontend.",
        "arquivo": "docker-compose.yml",
        "impacto": "Se app ficar em estado broken, Docker não sabe, não reinicia",
        "recomendacao": "Adicionar: healthcheck: { test: ['CMD', 'curl', '-f', 'http://localhost:3001/health'] }"
      },
      {
        "id": "DEVOPS-004",
        "severity": "high",
        "titulo": "Sem estratégia de rollback",
        "descricao": "Se deploy quebra produção, como voltar? Nenhum script de rollback.",
        "arquivo": "deploy-scripts.sh",
        "impacto": "Downtime longo em caso de erro. 1 hora de outage = R$ perdidos.",
        "recomendacao": "Usar blue-green deployment: manter 2 versões, switch com 0 downtime"
      },
      {
        "id": "DEVOPS-005",
        "severity": "high",
        "titulo": "Sem monitoring/alerting",
        "descricao": "Nenhuma ferramenta de monitoring (Datadog, New Relic, Prometheus).",
        "arquivo": "Não definido",
        "impacto": "Bugs em produção descobertos por reclamação de usuário, não por alertas.",
        "recomendacao": "Adicionar Sentry para errors, New Relic ou Prometheus para performance metrics"
      },
      {
        "id": "DEVOPS-006",
        "severity": "medium",
        "titulo": "Variáveis de ambiente não validadas",
        "descricao": ".env.example falta. No start, não valida se JWT_SECRET está definido corretamente.",
        "arquivo": ".env vs falta .env.example",
        "impacto": "Deploy falha silenciosamente se variável faltando",
        "recomendacao": "Criar backend/src/config/validateEnv.js: check required vars no startup, crash se faltando"
      },
      {
        "id": "DEVOPS-007",
        "severity": "medium",
        "titulo": "Migrations sem versionamento",
        "descricao": "database/migrations/ existe mas sem sistema de versionamento (Flyway/db-migrate).",
        "arquivo": "database/migrations/ (estrutura desconhecida)",
        "impacto": "Difícil rastrear qual SQL foi aplicado. Rollback manual e propenso a erro.",
        "recomendacao": "Usar knex-migrations ou db-migrate: 001_create_users.sql, 002_add_index.sql"
      },
      {
        "id": "DEVOPS-008",
        "severity": "medium",
        "titulo": "Sem backup strategy",
        "descricao": "Banco SQLite em backend/backend_data/limpeza.db. Se server perde, dados perdidos.",
        "arquivo": "database",
        "impacto": "Perda de dados em caso de falha de hardware",
        "recomendacao": "Usar Supabase (managed PostgreSQL com backups automáticos) ou s3 backups diários"
      },
      {
        "id": "DEVOPS-009",
        "severity": "medium",
        "titulo": "Sem secrets manager",
        "descricao": ".env local com secrets plaintext. Nenhuma integração com vault/AWS Secrets.",
        "arquivo": ".env:1-60",
        "impacto": "Se servidor hackeado, todas as chaves comprometidas",
        "recomendacao": "Usar AWS Secrets Manager, Azure KeyVault, ou HashiCorp Vault para gerenciar secrets"
      },
      {
        "id": "DEVOPS-010",
        "severity": "medium",
        "titulo": "Sem rate limiting em nginx/proxy",
        "descricao": "Rate limiting só em Express. Se hackeado Express, proteção por proxy inexiste.",
        "arquivo": "config/nginx/",
        "impacto": "DDoS pode derrotar rate limit de aplicação",
        "recomendacao": "Configurar nginx com limit_req para proteção em camada de proxy"
      },
      {
        "id": "DEVOPS-011",
        "severity": "low",
        "titulo": "Sem auto-scaling",
        "descricao": "Única instância. Sem load balancer, sem horizontal scaling.",
        "arquivo": "docker-compose.yml (1 backend, 1 frontend)",
        "impacto": "Com 1000 usuários simultâneos, sistema cai",
        "recomendacao": "Usar Kubernetes, ECS, ou Railway auto-scaling com mehrere instâncias"
      }
    ],
    "summary": "DevOps fraco. Sem CI/CD, health checks, rollback, monitoring. Produção em risco. Manual deployments, sem automação."
  },
  "8_ux_ui_issues": {
    "score": "65/100",
    "issues": [
      {
        "id": "UX-001",
        "severity": "high",
        "titulo": "Sem loading states em formulários",
        "descricao": "Botão de submit não desabilita durante fetch. Usuário clica múltiplas vezes.",
        "arquivo": "public/app.js:126-150 (handleAuth sem disable)",
        "impacto": "Duplo envio, bookings duplicados, confusão de usuário",
        "recomendacao": "Adicionar: button.disabled = true durante fetch, mostrar spinner, habilitar após response"
      },
      {
        "id": "UX-002",
        "severity": "high",
        "titulo": "Sem feedback de erro granular",
        "descricao": "showAlert() mostra mensagem genérica. Usuário não sabe qual campo está errado.",
        "arquivo": "public/app.js:460 (showAlert)",
        "exemplo": "Erro na validação de 5 campos → 'Erro ao criar agendamento'. Qual campo?",
        "recomendacao": "Mostrar erros por campo: { email: 'Email inválido', phone: 'Telefone muito curto' }"
      },
      {
        "id": "UX-003",
        "severity": "medium",
        "titulo": "Forms sem confirmação antes de submeter",
        "descricao": "Usuário clica submit acidentalmente, forma enviada antes de revisar.",
        "arquivo": "public/app.js (handleBooking, handlePayment)",
        "impacto": "Agendamentos indesejados, frustração",
        "recomendacao": "Mostrar modal de confirmação: 'Confirmar agendamento em [data] por R$ [valor]?'"
      },
      {
        "id": "UX-004",
        "severity": "medium",
        "titulo": "Falta de acessibilidade básica",
        "descricao": "Nenhum aria-label, alt text em imagens, keyboard navigation.",
        "arquivo": "public/index.html (img tags sem alt), buttons sem aria-label",
        "impacto": "Usuários com deficiência visual/motora não conseguem usar",
        "recomendacao": "Adicionar ARIA labels, alt text descritivo, testar com keyboard only"
      },
      {
        "id": "UX-005",
        "severity": "medium",
        "titulo": "Mobile UX quebrada",
        "descricao": "Botões muito pequenos (< 44px), spacing ruim, viewport não otimizada.",
        "arquivo": "public/index.html + app.js (sem responsive design adequado)",
        "impacto": "Mobile é 60% do tráfego. Usuários não conseguem clicar em botões.",
        "recomendacao": "Testar em mobile real. Buttons >= 44x44px. Media queries para < 768px"
      },
      {
        "id": "UX-006",
        "severity": "medium",
        "titulo": "Sem tratamento de offline",
        "descricao": "Se usuário perder conexão durante preenchimento, dados perdidos.",
        "arquivo": "public/app.js (sem service worker, sem localStorage cache)",
        "impacto": "Usuário refaz formulário inteiro",
        "recomendacao": "Salvar form state em localStorage, restaurar se página recarrega"
      },
      {
        "id": "UX-007",
        "severity": "medium",
        "titulo": "Sem skeleton loaders em dados dinâmicos",
        "descricao": "Quando carrega bookings, tela fica em branco. Usuário não sabe se está carregando ou erro.",
        "arquivo": "public/app.js:329 (loadUserBookings)",
        "impacto": "Incerteza, pensa que travou",
        "recomendacao": "Mostrar skeleton UI enquanto fetch: <div class='skeleton'>⠋⠋⠋</div>"
      },
      {
        "id": "UX-008",
        "severity": "medium",
        "titulo": "Falta de validação em tempo real",
        "descricao": "Validação só ao submeter. Usuário preenche 5 campos errados antes de saber.",
        "arquivo": "public/app.js (validação em handleAuth, não em input)",
        "impacto": "Experiência frustrada",
        "recomendacao": "Validar onchange: email, phone, CEP enquanto digita. Mostrar erro ao lado do campo."
      },
      {
        "id": "UX-009",
        "severity": "medium",
        "titulo": "Sem tooltips em campos confusos",
        "descricao": "Campo 'Metragem' sem explicação. Usuário não sabe se é m² total ou por cômodo.",
        "arquivo": "public/index.html (falta label explicativo)",
        "recomendacao": "Adicionar: <label title='Metragem total em m²'>Metragem</label> com ícone info"
      },
      {
        "id": "UX-010",
        "severity": "low",
        "titulo": "Sem breadcrumbs de navegação",
        "descricao": "Usuário não sabe onde está. Abas? Seções? Sem indicador visual.",
        "arquivo": "public/index.html",
        "recomendacao": "Adicionar breadcrumb bar: Home > Agendamento > Confirmação"
      },
      {
        "id": "UX-011",
        "severity": "low",
        "titulo": "Cores sem contraste suficiente",
        "descricao": "Alguns textos em gray (#6b7280) sobre fundo claro (#f6fbf7) pode violar WCAG",
        "arquivo": "public/index.html CSS",
        "recomendacao": "Testar com https://webaim.org/resources/contrastchecker/ (ratio >= 4.5:1)"
      }
    ],
    "summary": "UX média. Faltam loading states, feedback de erro, acessibilidade. Mobile não otimizado. Usuários precisam de melhor guidance."
  },
  "9_escalabilidade": {
    "score": "40/100",
    "issues": [
      {
        "id": "SCALE-001",
        "severity": "critical",
        "titulo": "Com 1000 usuários simultâneos: Database collaps",
        "descricao": "SQLite não suporta múltiplas conexões bem. N+1 queries × 1000 usuários = milhões de queries/s.",
        "arquivo": "backend/src/controllers/BookingController.js:155 (N+1)",
        "cenario": "100 usuários cada um com 10 bookings = 1000 queries iniciais. Se 100 simultâneos = 100k queries.",
        "impacto": "CRÍTICO: Sistema derribado com carga moderada",
        "recomendacao": "Migrar para PostgreSQL (Supabase), adicionar caching (Redis), otimizar queries"
      },
      {
        "id": "SCALE-002",
        "severity": "critical",
        "titulo": "Sem cache em dados frequentes",
        "descricao": "GET /services, GET /loyalty, GET /bookings sem cache. Recalculado a cada requisição.",
        "arquivo": "backend/src (sem middleware de caching)",
        "impacto": "Com 10k requisições/hora, cada uma refaz queries. Sem Redis, 10k queries desnecessárias.",
        "recomendacao": "Implementar Redis cache com TTL: CACHE_KEY = 'services:all', EX = 3600"
      },
      {
        "id": "SCALE-003",
        "severity": "critical",
        "titulo": "Sem connection pooling para DB",
        "descricao": "Cada request abre nova conexão SQLite. 100 simultâneos = 100 conexões. SQLite não suporta.",
        "arquivo": "backend/src/controllers/BookingController.js:13 (getDb())",
        "impacto": "Deadlocks, timeout, requests perdidos",
        "recomendacao": "Usar sqlite3 pool library, ou migrar para PostgreSQL com pgBouncer"
      },
      {
        "id": "SCALE-004",
        "severity": "high",
        "titulo": "Sem queue para operações pesadas",
        "descricao": "Email, SMS, notifications enviados síncronamente. 1000 usuários = 1000 SMSs bloqueando requests.",
        "arquivo": "backend/src/services/EmailService.js (sem async queue)",
        "impacto": "Requests ficam pendurados, timeouts, usuários frustrados",
        "recomendacao": "Usar Bull/RabbitMQ: encaderar envio de email em background, retornar logo ao usuário"
      },
      {
        "id": "SCALE-005",
        "severity": "high",
        "titulo": "Sem CDN para assets estáticos",
        "descricao": "CSS, JS, imagens servidas do mesmo servidor. Sem cache distribuído.",
        "arquivo": "backend/src/index.js (express.static)",
        "impacto": "Com 1M usuários, 1 gigabyte de bandwidth/dia. Custoso, lento.",
        "recomendacao": "Usar CloudFlare, AWS CloudFront para servir assets de edge servers"
      },
      {
        "id": "SCALE-006",
        "severity": "high",
        "titulo": "Sem load balancing",
        "descricao": "Única instância backend. Se quebra, aplicação inteira down.",
        "arquivo": "docker-compose.yml (1 backend)",
        "impacto": "99.9% SLA impossível com single instance",
        "recomendacao": "Usar Kubernetes, ECS, ou Railway com 3+ replicas + load balancer"
      },
      {
        "id": "SCALE-007",
        "severity": "medium",
        "titulo": "Sem sharding de dados",
        "descricao": "Todos dados em 1 banco. Com 10M registros, queries ficam lentas.",
        "arquivo": "database/schema.sql (1 BD único)",
        "impacto": "Impossível escalar além de ~1M registros com performance aceitável",
        "recomendacao": "Implementar sharding: usuários A-M em DB1, N-Z em DB2"
      },
      {
        "id": "SCALE-008",
        "severity": "medium",
        "titulo": "WebSocket sem clustering",
        "descricao": "Socket.io em 1 servidor. Se add 2º backend, mensagens não sincronizam entre servidores.",
        "arquivo": "backend/src/index.js:22",
        "impacto": "Chat não funciona em multi-instance setup",
        "recomendacao": "Usar Redis adapter para Socket.io: npm install socket.io-redis"
      },
      {
        "id": "SCALE-009",
        "severity": "medium",
        "titulo": "Sem API rate limiting por usuário",
        "descricao": "Rate limit global (100 req/15min) não proteção contra 1 usuário spam.",
        "arquivo": "backend/src/index.js:60",
        "impacto": "1 usuário pode derrotar rate limit consumindo todas 100 requisições",
        "recomendacao": "Adicionar rate limit por user_id: 20 req/min por usuário"
      }
    ],
    "summary": "Aplicação não escala. SQLite, sem cache, sem queue, sem load balancing. Com 1000 usuários, sistema quebra. PostgreSQL + Redis + Kubernetes necessários para produção."
  },
  "10_debitos_tecnicos": {
    "score": "50/100",
    "issues": [
      {
        "id": "DEBT-001",
        "severity": "high",
        "titulo": "Código duplicado em DB abstraction",
        "descricao": "getDb(), runAsync(), getAsync() repetidos em 5 controllers.",
        "arquivo": "BookingController:6-37, PaymentController:6-37, etc",
        "impacto": "Bug em runAsync() significa corrigir em 5 arquivos",
        "recomendacao": "Criar backend/src/db/Query.js com exportar funções, importar em todos controllers"
      },
      {
        "id": "DEBT-002",
        "severity": "high",
        "titulo": "Código comentado em produção",
        "descricao": "Múltiplas linhas comentadas com //TODO, //FIXME.",
        "arquivo": "backend/src/services/BookingService.js:186-195 (updateStatus)",
        "exemplo": "// await BookingService.updateStatus(booking.id, 'confirmed');",
        "impacto": "Confunde novos devs, reduz clareza",
        "recomendacao": "Deletar TODO que nunca será feito, ou criar GitHub Issues com link"
      },
      {
        "id": "DEBT-003",
        "severity": "medium",
        "titulo": "Documentação desatualizada",
        "descricao": "README.md menciona features não implementadas ou Swagger API não existe.",
        "arquivo": "README.md",
        "impacto": "Novos devs perdem tempo lendo docs incorretos",
        "recomendacao": "Manter README.md sincronizado, adicionar swagger/openapi.yaml"
      },
      {
        "id": "DEBT-004",
        "severity": "medium",
        "titulo": "Dependências desatualizadas",
        "descricao": "package.json tem express ^4.18.2 (2022), pode haver patches de segurança.",
        "arquivo": "backend/package.json:23-55",
        "recomendacao": "Rodar npm audit fix regularmente, atualizar minor versions"
      },
      {
        "id": "DEBT-005",
        "severity": "medium",
        "titulo": "Sem README em módulos complexos",
        "descricao": "Nenhum backend/src/services/README.md explicando padrão de services.",
        "arquivo": "backend/src/services/",
        "impacto": "Novo dev cria service incorretamente, sem pattern",
        "recomendacao": "Criar README em cada diretório com exemplos de uso"
      },
      {
        "id": "DEBT-006",
        "severity": "medium",
        "titulo": "Sem consistent error codes",
        "descricao": "Erros retornam { error: 'msg' }, { message: 'msg' }, { errors: [] } inconsistentemente.",
        "arquivo": "backend/src/controllers/ (vários formatos)",
        "impacto": "Frontend difícil de parsear erros",
        "recomendacao": "Padronizar: { status: 'error', code: 'INVALID_EMAIL', message: '...', details: {} }"
      },
      {
        "id": "DEBT-007",
        "severity": "medium",
        "titulo": "Sem versionamento de API documentado",
        "descricao": "Changelog não existe. Difícil saber quando foi adicionado/removido recurso.",
        "arquivo": "Não existe CHANGELOG.md",
        "recomendacao": "Manter CHANGELOG.md com versões, features adicionadas, bugs corrigidos, breaking changes"
      },
      {
        "id": "DEBT-008",
        "severity": "low",
        "titulo": "Nomes de variáveis imprecisos",
        "descricao": "Variáveis genéricas como 'data', 'result', 'item' ao invés de 'bookingData', 'paymentResult'.",
        "arquivo": "backend/src (vários)",
        "impacto": "Reduz legibilidade",
        "recomendacao": "Code review checklist: nomes descritivos, sem single-letter vars"
      },
      {
        "id": "DEBT-009",
        "severity": "low",
        "titulo": "Sem JSDoc em funções públicas",
        "descricao": "Funções em services sem comentário descrevendo params, return, exceptions.",
        "arquivo": "backend/src/services/*.js",
        "recomendacao": "Adicionar: /** @param {number} bookingId - Booking identifier \\n * @returns {Promise<Booking>} */​"
      }
    ],
    "summary": "Débitos técnicos significativos. Duplicação, código comentado, docs desatualizadas, sem versionamento. Refatoração estrutural necessária."
  },
  "critical_issues_resumo": {
    "top_5_blocking": [
      {
        "rank": 1,
        "issue": "SEC-001: Secrets em .env públicas no Git",
        "acao": "Imediatamente adicionar .env a .gitignore, usar secrets manager (AWS)",
        "tempo": "30 minutos"
      },
      {
        "rank": 2,
        "issue": "FE-002: Cartão de crédito em JSON plano (PCI-DSS VIOLADO)",
        "acao": "Integrar Stripe.js/MercadoPago SDK no frontend, backend recebe só token",
        "tempo": "4 horas"
      },
      {
        "rank": 3,
        "issue": "FE-001: XSS via innerHTML sem sanitização",
        "acao": "Sanitizar todas renderizações com DOMPurify ou textContent",
        "tempo": "2 horas"
      },
      {
        "rank": 4,
        "issue": "PERF-001: N+1 queries em getUserBookings",
        "acao": "Adicionar JOIN SQL, testar com 1000 bookings",
        "tempo": "1 hora"
      },
      {
        "rank": 5,
        "issue": "TEST-001: Cobertura de testes < 30%",
        "acao": "Adicionar tests para Payment/Auth/Booking flows, implementar E2E com Cypress",
        "tempo": "16 horas"
      }
    ]
  },
  "recomendacoes_prioritarias": {
    "top_5_acoes": [
      {
        "prioridade": 1,
        "acao": "Implementar Stripe/MercadoPago SDK propriamente (remover transmissão de cartão)",
        "impacto": "CRÍTICO - Conformidade PCI-DSS, legal compliance, segurança",
        "tempo_semanas": 1,
        "equipe": "2 devs backend + 1 frontend"
      },
      {
        "prioridade": 2,
        "acao": "Adicionar suite de testes E2E (Cypress) cobrindo user flows completos",
        "impacto": "HIGH - Detecta regressions, confiança em deploy",
        "tempo_semanas": 2,
        "equipe": "1 QA engineer"
      },
      {
        "prioridade": 3,
        "acao": "Migrar de SQLite para PostgreSQL (Supabase), implementar Redis cache",
        "impacto": "CRITICAL - Escalabilidade, performance, backup automático",
        "tempo_semanas": 2,
        "equipe": "1-2 devs backend"
      },
      {
        "prioridade": 4,
        "acao": "Implementar CI/CD com GitHub Actions (test → lint → build → deploy)",
        "impacto": "HIGH - Automação, segurança, rapidez de deploy",
        "tempo_semanas": 1,
        "equipe": "1 devops/backend"
      },
      {
        "prioridade": 5,
        "acao": "Refatorar frontend em módulos (auth.js, bookings.js, etc) com sanitização HTML",
        "impacto": "HIGH - Qualidade, manutenibilidade, segurança (XSS)",
        "tempo_semanas": 1.5,
        "equipe": "1-2 frontend devs"
      }
    ],
    "quick_wins": [
      "Adicionar .env.example com instruções",
      "Minificar JS/CSS, habilitar gzip compression",
      "Adicionar loading states em formulários",
      "Implementar error boundaries em componentes críticos",
      "Adicionar 5 E2E tests com Cypress para fluxo de booking completo"
    ]
  },
  "roadmap_3_meses": {
    "mes_1": [
      "Implementar Stripe SDK (segurança PCI-DSS)",
      "Sanitizar XSS em frontend",
      "Adicionar cobertura de testes básica (payment, auth)",
      "Refatorar frontend em módulos"
    ],
    "mes_2": [
      "Migrar SQLite → PostgreSQL",
      "Implementar Redis cache",
      "CI/CD com GitHub Actions",
      "Adicionar 20+ E2E tests"
    ],
    "mes_3": [
      "Otimizações de performance (índices, query tuning)",
      "Deploy em múltiplas instâncias + load balancer",
      "Monitoring + alertas (Sentry, New Relic)",
      "Documentation (Swagger, API guide)"
    ]
  },
  "conclusao": {
    "status_geral": "65/100 - Aplicação funcional com gaps críticos em segurança, performance, testes",
    "recomendacao_producao": "❌ NÃO RECOMENDADO para produção com dados reais sem corrigir críticas",
    "riscos_negocio": [
      "Violação PCI-DSS (cartão de crédito em plaintext)",
      "XSS attacks possíveis, comprometimento de usuários",
      "Collapse sob carga (1000+ usuários)",
      "Sem backups de dados (perda total possível)",
      "Sem CI/CD (qualidade imprevisível)"
    ],
    "timeline_mvp_seguro": "6-8 semanas com equipe de 4 devs",
    "next_steps": "1) Corrigir críticas de segurança, 2) Adicionar testes, 3) Escalar infra, 4) Deploy em produção com monitoramento"
  }
}
