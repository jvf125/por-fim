"use strict";(()=>{var e={};e.id=180,e.ids=[180,888,660],e.modules={1103:(e,t,a)=>{a.r(t),a.d(t,{config:()=>f,default:()=>x,getServerSideProps:()=>b,getStaticPaths:()=>p,getStaticProps:()=>h,reportWebVitals:()=>v,routeModule:()=>y,unstable_getServerProps:()=>N,unstable_getServerSideProps:()=>D,unstable_getStaticParams:()=>S,unstable_getStaticPaths:()=>w,unstable_getStaticProps:()=>j});var s={};a.r(s),a.d(s,{default:()=>Chat});var r=a(7093),n=a(5244),i=a(1323),o=a(6764),l=a(9467),d=a(997),c=a(6689),m=a(8165),u=a(3120),g=a(2797);let Common_ChatComponent=function({bookingId:e,userId:t,userName:a="Voc\xea"}){let[s,r]=(0,c.useState)([]),[n,i]=(0,c.useState)(""),[o,l]=(0,c.useState)(!0),[m,u]=(0,c.useState)(!1),[x,h]=(0,c.useState)("online"),p=(0,c.useRef)(null),{addToast:b}=(0,g.p)(),scrollToBottom=()=>{p.current?.scrollIntoView({behavior:"smooth"})};(0,c.useEffect)(()=>{scrollToBottom()},[s]),(0,c.useEffect)(()=>{let fetchMessages=async()=>{try{let t=process.env.NEXT_PUBLIC_API_URL||"http://localhost:3001",a=await fetch(`${t}/api/chat/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")||""}`},credentials:"include"});if(!a.ok)throw Error("Falha ao carregar mensagens");let s=await a.json();r(s.messages||generateMockMessages()),l(!1),simulateWebSocket()}catch(e){console.error("Erro ao carregar mensagens:",e),r(generateMockMessages()),l(!1),simulateWebSocket()}};fetchMessages()},[e]);let generateMockMessages=()=>[{id:1,sender:"staff",senderName:"Ana Silva",message:"Ol\xe1! Confirmo o agendamento para amanh\xe3 \xe0s 09:00",timestamp:new Date(Date.now()-36e5),status:"lido"},{id:2,sender:"client",senderName:"Maria",message:"Perfeito! At\xe9 amanh\xe3 ent\xe3o",timestamp:new Date(Date.now()-3e6),status:"lido"},{id:3,sender:"staff",senderName:"Ana Silva",message:"Vou chegar 10 minutos mais cedo para verificar tudo",timestamp:new Date(Date.now()-24e5),status:"lido"}],simulateWebSocket=()=>{h("online")},handleSendMessage=async t=>{if(t.preventDefault(),!n.trim()){b("Mensagem vazia","warning");return}u(!0);try{let t=process.env.NEXT_PUBLIC_API_URL||"http://localhost:3001",o=await fetch(`${t}/api/chat/${e}/send`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")||""}`},body:JSON.stringify({message:n}),credentials:"include"});if(!o.ok)throw Error("Falha ao enviar mensagem");let l=await o.json(),d={id:l.id||Date.now(),sender:"client",senderName:a,message:n,timestamp:new Date,status:"enviado"};r([...s,d]),i(""),b("Mensagem enviada","success"),u(!1)}catch(e){console.error("Erro ao enviar:",e),b("Erro ao enviar mensagem","error"),u(!1)}},handleRemoveMessage=e=>{r(s.filter(t=>t.id!==e)),b("Mensagem removida","info")},formatTime=e=>new Date(e).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}),formatDate=e=>{let t=new Date,a=new Date(t);a.setDate(a.getDate()-1);let s=new Date(e);return s.toDateString()===t.toDateString()?"Hoje":s.toDateString()===a.toDateString()?"Ontem":s.toLocaleDateString("pt-BR")};return o?d.jsx("div",{className:"p-6 text-center",children:"⏳ Carregando chat..."}):(0,d.jsxs)("div",{className:"flex flex-col h-screen bg-white rounded-lg shadow-lg overflow-hidden max-h-96",children:[d.jsx("div",{className:"p-4 bg-gradient-to-r from-blue-600 to-blue-700 text-white",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[(0,d.jsxs)("div",{className:"relative",children:[d.jsx("div",{className:"w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl",children:"\uD83D\uDCAC"}),d.jsx("div",{className:`absolute bottom-0 right-0 w-3 h-3 rounded-full ${"online"===x?"bg-green-400":"bg-gray-400"}`})]}),(0,d.jsxs)("div",{children:[d.jsx("p",{className:"font-semibold",children:"Chat - Agendamento"}),d.jsx("p",{className:"text-xs text-blue-100",children:"online"===x?"\uD83D\uDFE2 Online":"⚪ Offline"})]})]}),d.jsx("button",{className:"text-white hover:bg-white/20 p-2 rounded transition",children:"⋮"})]})}),(0,d.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50",children:[s.map((e,t)=>{let a=0===t||formatDate(s[t-1].timestamp)!==formatDate(e.timestamp);return(0,d.jsxs)("div",{children:[a&&(0,d.jsxs)("div",{className:"flex items-center gap-2 my-4",children:[d.jsx("div",{className:"flex-1 border-t border-gray-300"}),d.jsx("span",{className:"text-xs text-gray-500 px-2",children:formatDate(e.timestamp)}),d.jsx("div",{className:"flex-1 border-t border-gray-300"})]}),(0,d.jsxs)("div",{className:`flex gap-2 ${"client"===e.sender?"flex-row-reverse":""}`,children:[d.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-gradient-to-br from-blue-400 to-blue-600 flex items-center justify-center text-white text-sm font-bold",children:e.senderName.charAt(0)}),(0,d.jsxs)("div",{className:`max-w-xs lg:max-w-md ${"client"===e.sender?"items-end":"items-start"} flex flex-col`,children:[d.jsx("p",{className:`text-xs font-semibold ${"client"===e.sender?"text-right":""}`,children:e.senderName}),(0,d.jsxs)("div",{className:`mt-1 p-3 rounded-lg text-sm ${"client"===e.sender?"bg-blue-600 text-white rounded-br-none":"bg-white border border-gray-200 text-gray-900 rounded-bl-none"} hover:shadow-md transition group relative`,children:[d.jsx("p",{className:"break-words",children:e.message}),d.jsx("button",{onClick:()=>handleRemoveMessage(e.id),className:"absolute -top-6 right-0 text-xs opacity-0 group-hover:opacity-100 transition bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"✕"})]}),(0,d.jsxs)("p",{className:`text-xs text-gray-500 mt-1 ${"client"===e.sender?"text-right":""}`,children:[formatTime(e.timestamp)," ","lido"===e.status?"✓✓":"enviado"===e.status?"✓":"⏱"]})]})]})]},e.id)}),d.jsx("div",{ref:p})]}),(0,d.jsxs)("form",{onSubmit:handleSendMessage,className:"p-4 border-t border-gray-200 bg-white",children:[(0,d.jsxs)("div",{className:"flex gap-2",children:[d.jsx("button",{type:"button",className:"flex-shrink-0 px-3 py-2 text-xl bg-gray-100 hover:bg-gray-200 rounded transition",title:"Anexar arquivo",children:"\uD83D\uDCCE"}),d.jsx("input",{type:"text",value:n,onChange:e=>i(e.target.value),placeholder:"Digite sua mensagem...",disabled:m,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),d.jsx("button",{type:"submit",disabled:m||!n.trim(),className:"flex-shrink-0 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed",children:m?"⏳":"➤"})]}),(0,d.jsxs)("p",{className:"text-xs text-gray-500 mt-2",children:["\uD83D\uDCA1 Use ",d.jsx("strong",{children:"Enter"})," para enviar, ",d.jsx("strong",{children:"Shift+Enter"})," para quebra de linha"]})]})]})};function Chat(){let[e]=(0,c.useState)("booking_001");return(0,d.jsxs)("div",{className:"flex flex-col min-h-screen",children:[d.jsx(m.Z,{}),d.jsx("main",{className:"flex-grow p-6 bg-gray-50",children:(0,d.jsxs)("div",{className:"max-w-2xl mx-auto",children:[d.jsx("h1",{className:"text-3xl font-bold mb-6",children:"\uD83D\uDCAC Chat do Agendamento"}),d.jsx(Common_ChatComponent,{bookingId:e,userId:"user_123",userName:"Maria Silva"})]})}),d.jsx(u.Z,{})]})}let x=(0,i.l)(s,"default"),h=(0,i.l)(s,"getStaticProps"),p=(0,i.l)(s,"getStaticPaths"),b=(0,i.l)(s,"getServerSideProps"),f=(0,i.l)(s,"config"),v=(0,i.l)(s,"reportWebVitals"),j=(0,i.l)(s,"unstable_getStaticProps"),w=(0,i.l)(s,"unstable_getStaticPaths"),S=(0,i.l)(s,"unstable_getStaticParams"),N=(0,i.l)(s,"unstable_getServerProps"),D=(0,i.l)(s,"unstable_getServerSideProps"),y=new r.PagesRouteModule({definition:{kind:n.x.PAGES,page:"/chat",pathname:"/chat",bundlePath:"",filename:""},components:{App:l.default,Document:o.default},userland:s})},5427:e=>{e.exports=require("@sentry/react")},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},6689:e=>{e.exports=require("react")},997:e=>{e.exports=require("react/jsx-runtime")},1017:e=>{e.exports=require("path")}};var t=require("../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),a=t.X(0,[859,656,664,467,764,708],()=>__webpack_exec__(1103));module.exports=a})();