(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[180],{2583:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/chat",function(){return a(4425)}])},4425:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return Chat}});var s=a(5893),n=a(7294),r=a(8165),o=a(3120),i=a(2797),l=a(3454),Common_ChatComponent=function(e){let{bookingId:t,userId:a,userName:r="Voc\xea"}=e,[o,c]=(0,n.useState)([]),[d,m]=(0,n.useState)(""),[x,u]=(0,n.useState)(!0),[h,g]=(0,n.useState)(!1),[f,b]=(0,n.useState)("online"),p=(0,n.useRef)(null),{addToast:v}=(0,i.p)(),scrollToBottom=()=>{var e;null===(e=p.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};(0,n.useEffect)(()=>{scrollToBottom()},[o]),(0,n.useEffect)(()=>{let fetchMessages=async()=>{try{let e=l.env.NEXT_PUBLIC_API_URL||"http://localhost:3001",a=await fetch("".concat(e,"/api/chat/").concat(t),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")||"")},credentials:"include"});if(!a.ok)throw Error("Falha ao carregar mensagens");let s=await a.json();c(s.messages||generateMockMessages()),u(!1),simulateWebSocket()}catch(e){console.error("Erro ao carregar mensagens:",e),c(generateMockMessages()),u(!1),simulateWebSocket()}};fetchMessages()},[t]);let generateMockMessages=()=>[{id:1,sender:"staff",senderName:"Ana Silva",message:"Ol\xe1! Confirmo o agendamento para amanh\xe3 \xe0s 09:00",timestamp:new Date(Date.now()-36e5),status:"lido"},{id:2,sender:"client",senderName:"Maria",message:"Perfeito! At\xe9 amanh\xe3 ent\xe3o",timestamp:new Date(Date.now()-3e6),status:"lido"},{id:3,sender:"staff",senderName:"Ana Silva",message:"Vou chegar 10 minutos mais cedo para verificar tudo",timestamp:new Date(Date.now()-24e5),status:"lido"}],simulateWebSocket=()=>{b("online")},handleSendMessage=async e=>{if(e.preventDefault(),!d.trim()){v("Mensagem vazia","warning");return}g(!0);try{let e=l.env.NEXT_PUBLIC_API_URL||"http://localhost:3001",a=await fetch("".concat(e,"/api/chat/").concat(t,"/send"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token")||"")},body:JSON.stringify({message:d}),credentials:"include"});if(!a.ok)throw Error("Falha ao enviar mensagem");let s=await a.json(),n={id:s.id||Date.now(),sender:"client",senderName:r,message:d,timestamp:new Date,status:"enviado"};c([...o,n]),m(""),v("Mensagem enviada","success"),g(!1)}catch(e){console.error("Erro ao enviar:",e),v("Erro ao enviar mensagem","error"),g(!1)}},handleRemoveMessage=e=>{c(o.filter(t=>t.id!==e)),v("Mensagem removida","info")},formatTime=e=>new Date(e).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}),formatDate=e=>{let t=new Date,a=new Date(t);a.setDate(a.getDate()-1);let s=new Date(e);return s.toDateString()===t.toDateString()?"Hoje":s.toDateString()===a.toDateString()?"Ontem":s.toLocaleDateString("pt-BR")};return x?(0,s.jsx)("div",{className:"p-6 text-center",children:"⏳ Carregando chat..."}):(0,s.jsxs)("div",{className:"flex flex-col h-screen bg-white rounded-lg shadow-lg overflow-hidden max-h-96",children:[(0,s.jsx)("div",{className:"p-4 bg-gradient-to-r from-blue-600 to-blue-700 text-white",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("div",{className:"w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl",children:"\uD83D\uDCAC"}),(0,s.jsx)("div",{className:"absolute bottom-0 right-0 w-3 h-3 rounded-full ".concat("online"===f?"bg-green-400":"bg-gray-400")})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-semibold",children:"Chat - Agendamento"}),(0,s.jsx)("p",{className:"text-xs text-blue-100",children:"online"===f?"\uD83D\uDFE2 Online":"⚪ Offline"})]})]}),(0,s.jsx)("button",{className:"text-white hover:bg-white/20 p-2 rounded transition",children:"⋮"})]})}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50",children:[o.map((e,t)=>{let a=0===t||formatDate(o[t-1].timestamp)!==formatDate(e.timestamp);return(0,s.jsxs)("div",{children:[a&&(0,s.jsxs)("div",{className:"flex items-center gap-2 my-4",children:[(0,s.jsx)("div",{className:"flex-1 border-t border-gray-300"}),(0,s.jsx)("span",{className:"text-xs text-gray-500 px-2",children:formatDate(e.timestamp)}),(0,s.jsx)("div",{className:"flex-1 border-t border-gray-300"})]}),(0,s.jsxs)("div",{className:"flex gap-2 ".concat("client"===e.sender?"flex-row-reverse":""),children:[(0,s.jsx)("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-gradient-to-br from-blue-400 to-blue-600 flex items-center justify-center text-white text-sm font-bold",children:e.senderName.charAt(0)}),(0,s.jsxs)("div",{className:"max-w-xs lg:max-w-md ".concat("client"===e.sender?"items-end":"items-start"," flex flex-col"),children:[(0,s.jsx)("p",{className:"text-xs font-semibold ".concat("client"===e.sender?"text-right":""),children:e.senderName}),(0,s.jsxs)("div",{className:"mt-1 p-3 rounded-lg text-sm ".concat("client"===e.sender?"bg-blue-600 text-white rounded-br-none":"bg-white border border-gray-200 text-gray-900 rounded-bl-none"," hover:shadow-md transition group relative"),children:[(0,s.jsx)("p",{className:"break-words",children:e.message}),(0,s.jsx)("button",{onClick:()=>handleRemoveMessage(e.id),className:"absolute -top-6 right-0 text-xs opacity-0 group-hover:opacity-100 transition bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"✕"})]}),(0,s.jsxs)("p",{className:"text-xs text-gray-500 mt-1 ".concat("client"===e.sender?"text-right":""),children:[formatTime(e.timestamp)," ","lido"===e.status?"✓✓":"enviado"===e.status?"✓":"⏱"]})]})]})]},e.id)}),(0,s.jsx)("div",{ref:p})]}),(0,s.jsxs)("form",{onSubmit:handleSendMessage,className:"p-4 border-t border-gray-200 bg-white",children:[(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{type:"button",className:"flex-shrink-0 px-3 py-2 text-xl bg-gray-100 hover:bg-gray-200 rounded transition",title:"Anexar arquivo",children:"\uD83D\uDCCE"}),(0,s.jsx)("input",{type:"text",value:d,onChange:e=>m(e.target.value),placeholder:"Digite sua mensagem...",disabled:h,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,s.jsx)("button",{type:"submit",disabled:h||!d.trim(),className:"flex-shrink-0 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed",children:h?"⏳":"➤"})]}),(0,s.jsxs)("p",{className:"text-xs text-gray-500 mt-2",children:["\uD83D\uDCA1 Use ",(0,s.jsx)("strong",{children:"Enter"})," para enviar, ",(0,s.jsx)("strong",{children:"Shift+Enter"})," para quebra de linha"]})]})]})};function Chat(){let[e]=(0,n.useState)("booking_001");return(0,s.jsxs)("div",{className:"flex flex-col min-h-screen",children:[(0,s.jsx)(r.Z,{}),(0,s.jsx)("main",{className:"flex-grow p-6 bg-gray-50",children:(0,s.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"\uD83D\uDCAC Chat do Agendamento"}),(0,s.jsx)(Common_ChatComponent,{bookingId:e,userId:"user_123",userName:"Maria Silva"})]})}),(0,s.jsx)(o.Z,{})]})}}},function(e){e.O(0,[664,708,774,888,179],function(){return e(e.s=2583)}),_N_E=e.O()}]);